{% extends 'base.html' %}
{% load static %}

{% block title %}Buy {{ item.title }} - Sick Bed Services{% endblock %}

{% block content %}
<style>
  .buy-container {
    max-width: 1000px;
    margin: 40px auto;
    background: #fff;
    padding: 30px 40px;
    border-radius: 10px;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    display: flex;
    flex-wrap: wrap;
    gap: 35px;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #333;
  }
  .left-image {
    flex: 1 1 40%;
  }
  .item-image {
    width: 100%;
    height: 350px;
    border-radius: 10px;
    object-fit: cover;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    transition: transform 0.3s ease;
  }
  .item-image:hover {
    transform: scale(1.03);
  }
  .right-details {
    flex: 1 1 55%;
  }
  .item-info h2 {
    font-size: 28px;
    margin-bottom: 15px;
    color: #007bff;
    font-weight: 700;
  }
  .item-info p {
    font-size: 16px;
    margin: 10px 0;
    line-height: 1.5;
  }
  .item-info p strong {
    color: #222;
  }
  .form-section {
    margin-top: 30px;
  }
  label {
    font-weight: 600;
    display: block;
    margin-top: 20px;
    color: #444;
  }
  input[type="date"] {
    width: 100%;
    padding: 12px 15px;
    font-size: 16px;
    border: 1.8px solid #ccc;
    border-radius: 6px;
    margin-top: 8px;
    transition: border-color 0.3s ease;
  }
  input[type="date"]:focus {
    border-color: #007bff;
    outline: none;
  }
  .terms-checkbox-container {
    margin-top: 25px;
    font-size: 15px;
    color: #555;
  }
  .terms-checkbox-container a {
    color: #007bff;
    text-decoration: none;
    font-weight: 600;
  }
  .terms-checkbox-container a:hover {
    text-decoration: underline;
  }
  .submit-btn {
    margin-top: 30px;
    background: #007bff;
    color: #fff;
    padding: 14px 28px;
    border: none;
    border-radius: 6px;
    font-size: 17px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 123, 255, 0.4);
    transition: background-color 0.3s ease, box-shadow 0.3s ease;
    width: 100%;
  }
  .submit-btn:disabled {
    background: #a3d0ff;
    cursor: not-allowed;
    box-shadow: none;
  }
  .submit-btn:not(:disabled):hover {
    background-color: #0056b3;
    box-shadow: 0 6px 18px rgba(0, 86, 179, 0.6);
  }
  @media (max-width: 768px) {
    .buy-container {
      flex-direction: column;
      padding: 25px 20px;
    }
    .item-image {
      height: 250px;
    }
    .submit-btn {
      font-size: 16px;
      padding: 12px 20px;
    }
  }
  /* Messages styles */
  ul.messages {
    list-style: none;
    padding-left: 0;
    margin-top: 20px;
  }
  ul.messages li.buy {
    background: #ffefef;
    border: 1px solid #f44336;
    color: #b71c1c;
    padding: 12px 15px;
    border-radius: 6px;
    margin-bottom: 12px;
    font-weight: 600;
  }

  .terms-link {
  color: #007bff;
  font-weight: 600;
  text-decoration: none;
  font-size: 16px;
}
.terms-link:hover {
  text-decoration: underline;
}
.check-here-btn {
  background: #f0f8ff;
  color: #007bff;
  border: 1.5px solid #007bff;
  border-radius: 5px;
  padding: 7px 18px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.2s;
}
.check-here-btn:hover {
  background: #e3effc;
}


h5 {
    font-size: 12px;           /* Adjust size */
    font-weight: 400;          /* Semi-bold */
    color: #333333;            /* Dark text color */
    text-transform: uppercase; /* Optional: all caps */
    letter-spacing: 1px;       /* Slight spacing */
    margin-bottom: 15px;       /* Space below heading */
    border-bottom: 2px solid #007bff; /* Underline for style */
    padding-bottom: 5px;       /* Space between text and underline */
}

</style>

<div class="buy-container">
  <div class="left-image">
    <img src="{{ item.image.url }}" alt="{{ item.title }}" class="item-image" />
  </div>

  <div class="right-details">
    <div class="item-info">
      <h2>{{ item.title }}</h2>
      <p><strong>Rent per day:</strong> ₹{{ item.price_per_day }}</p>
      <p><strong>Deposit:</strong> ₹1,000</p>
      
      {% if item.description %}
        <p><strong>Description:</strong> {{ item.description }}</p>
      {% endif %}
      
      <p><strong>Total Days:</strong> <span id="total_days">-</span></p>
      <p><strong>Rent (only):</strong> ₹<span id="rent_amount">-</span></p>
    </div>

    {% if messages %}
      <ul class="messages">
        {% for message in messages %}
          {% if "buy" in message.tags %}
            <li class="{{ message.tags }}">{{ message }}</li>
          {% endif %}
        {% endfor %}
      </ul>
    {% endif %}

    <div class="form-section">
      <form method="POST" action="" id="rentForm">
        {% csrf_token %}
        <label for="start_date">Start Date:</label>
        <input 
          type="date" 
          id="start_date" 
          name="start_date" 
          required 
          min="{{ today|date:'Y-m-d' }}" 
        />

        <label for="end_date">End Date:</label>
        <input 
          type="date" 
          id="end_date" 
          name="end_date" 
          required 
          min="{{ today|date:'Y-m-d' }}" 
        />

       <div class="terms-checkbox-container">

<label style="display:flex; align-items:center; gap:12px; margin-top:20px;">
    <input type="checkbox" id="terms_checkbox" style="width:20px; height:20px; margin-left:10px;">

    
        <h5>Terms & Conditions</h5>
    
    <a href="{% url 'terms' %}" target="_blank">Check Here</a>

</label>
  </div>


        <button type="submit" class="submit-btn" id="submitBtn" disabled>
          Proceed to Rent
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  const pricePerDay = Number({{ item.price_per_day|floatformat:"2"|safe }});
  const rentAmountEl = document.getElementById("rent_amount");
  const totalDaysEl = document.getElementById("total_days");
  const termsCheckbox = document.getElementById("terms_checkbox");
  const submitBtn = document.getElementById("submitBtn");

  function calculateTotal() {
    const start = document.getElementById("start_date").value;
    const end = document.getElementById("end_date").value;

    if (start && end) {
      const startDate = new Date(start);
      const endDate = new Date(end);

      if (!isNaN(startDate) && !isNaN(endDate) && endDate >= startDate) {
        const days = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
        const rent = days * pricePerDay;

        totalDaysEl.innerText = days;
        rentAmountEl.innerText = rent.toFixed(2);
      } else {
        totalDaysEl.innerText = "-";
        rentAmountEl.innerText = "-";
      }
    } else {
      totalDaysEl.innerText = "-";
      rentAmountEl.innerText = "-";
    }
  }

  document.getElementById("start_date").addEventListener("change", calculateTotal);
  document.getElementById("end_date").addEventListener("change", calculateTotal);
  window.addEventListener("DOMContentLoaded", calculateTotal);

  termsCheckbox.addEventListener("change", () => {
    submitBtn.disabled = !termsCheckbox.checked;
  });
</script>
{% endblock %}
